version: "2"

services:
  test-runner:
    image: node:8
    working_dir: /tests
    command: ["sh", "-c", "yarn install --cache-folder /yarn-cache --production=false && yarn run test"]
    volumes:
      - ../index.js/:/tests/index.js
      - ../src/:/tests/src
      - ../test/:/tests/test
      - ../package.json/:/tests/package.json
      - ../yarn.lock/:/tests/yarn.lock
      - ./.yarn-cache:/yarn-cache
      - logs:/tests/logs
      - userimages:/userimages
    environment:
      NODE_ENV: production
      ENV: prod
      OSEM_dbhost: db
      OSEM_dbuser: senseboxapiuser
      OSEM_dbuserpass: userpass
      OSEM_imageFolder: /userimages

  db:
    image: sensebox/opensensemap-api-mongo
    environment:
      OSEM_dbuser: senseboxapiuser
      OSEM_dbuserpass: userpass

volumes:
  logs:
  userimages:
